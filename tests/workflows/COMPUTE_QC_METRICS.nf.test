// Copyright (C) 2023 Genome Surveillance Unit/Genome Research Ltd.

nextflow_workflow {

    name "Test Workflow COMPUTE_QC_METRICS"
    script "workflows/COMPUTE_QC_METRICS.nf"
    workflow "COMPUTE_QC_METRICS"

    test("Should run without failures") {

        when {
            params {
                meta = [
                    id:"test2.9000000",
                    sample_id:"test2",
                    taxid:9000000,
                ]
                bam_file ="${projectDir}/tests/test_data/test_alignments/test2.9000000.sorted.bam"
                bai_file ="${projectDir}/tests/test_data/test_alignments/test2.9000000.sorted.bam.bai"
                ivar_variants_file ="${projectDir}/tests/test_data/test_ivar_variants_out/test2.9000000.variants.tsv"
                fasta_file ="${projectDir}/tests/test_data/test_consensuses/test2.9000000.consensus.fa"
            }
            workflow {
                """
                // define inputs of the workflow here. Example:
                input[0] = Channel.of(tuple(params.meta, params.bam_file, params.bai_file, params.fasta_file, params.ivar_variants_file))
                """
            }
        }

        then {
            assert workflow.success
            assert snapshot(workflow.out).match()
        }

    }

}
          