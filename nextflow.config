includeConfig "./conf/containers.config"
includeConfig "./conf/resources_handling.config"

params {

    entry_point = "sort_reads"
    manifest = null

    // kraken database
    db_path = null
    db_library_fa_path = null


    // k2r 
    k2r_fq_load_mode = "full"
    k2r_pooling_mode = "kmeans"

    // set maximum number of reads to be accepted
    // any fastq file pair
    k2r_max_total_reads_per_fq = 10000000
    k2r_dump_fq_mem = "6 GB"
    // kraken report filter
    min_reads_for_taxid = 100

    // ivar params
    ivar_min_depth = 10
    ivar_freq_threshold = 0.75

    // virus subtyping branching keywords
    scv2_keyword = "Severe acute respiratory syndrome coronavirus 2"

    //subtyping switchs
    do_scov2_subtyping = true

    // generate consensus entry point
    consensus_mnf = null

    // set where output files should be published
    results_dir = "$launchDir/output/"


}

// Execution layer settings
docker {
    enabled = false
}

singularity {
    enabled = true
}

process {
    cache='lenient'

}
profiles {
    sanger_standard {
        docker {
            enabled = false
        }
        
        singularity {
            enabled = true
            autoMounts = true
            cacheDir = "$PWD"
            runOptions = "--bind /lustre,/nfs,/software,/data/"
        }

        process {
            // by default
            cache='lenient'
            executor='local'

            // run k2r on lsf
            withName: run_k2r_sort_reads{
                executor = 'lsf'
                //label = "mem_k2r_escalate"
                cpus = 1
            }

            withName: run_k2r_dump_fastqs_and_pre_report{
                executor = 'lsf'
                //label = "mem_k2r_escalate"
                cpus = 1
            }

            // run k2r on lsf
            withName:run_kraken{
                executor='lsf'
                cpus=16
                memory='1 GB'
            }
        }
        executor {
            jobName={ "RVI-preprocess - $task.name - $task.tag" }
            perJobMemLimit=true

        }
    }
}
